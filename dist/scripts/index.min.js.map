{"version":3,"sources":["scripts/index.js"],"sourceRoot":"/public","sourcesContent":["/// <reference lib=\"dom\" />\n\nimport { Temporal } from 'temporal-polyfill'\nimport Unstable_gallery from \"./unstable_gallery.js\"\n\nconst spinner = document.createElement('img')\nspinner.src = '/img/fallback.jpeg'\nspinner.classList.add('loader')\nconst app = document.getElementById('root')\n\napp.appendChild(spinner)\n\ntry {\n  const params = new URLSearchParams({ listType })\n  const response = await fetch(`./api/dayrecord?${params.toString()}`)\n  const dayRecords = await response.json()\n  const newData = [null,null,null,null,null, null,null] // 7 days a week\n  let today = Temporal.Now.plainDateISO('Asia/Ho_Chi_Minh');\n  for (let i = 0; i < dayRecords.length && i < 7; i++) {\n    const d = dayRecords[i]\n    const { dayOfWeek } = Temporal.PlainDate.from(d.date)\n    const ratioDailyTarget = d.net_words_change / targetWordsDaily * 100\n    newData[dayOfWeek - 1] = {\n      source: d,\n      id: d.id,\n      w: 400,\n      h: 400,\n      prompt: d.net_words_change,\n      header: getDateName(d.date),\n      ratioDailyTarget,\n    }\n  }\n  for (let i = 0; i < 7; i++) {\n    const d = newData[i]\n    if (d === null) {\n      newData[i] = {\n        source: null,\n        id: i,\n        w: 400,\n        h: 400,\n        prompt: 0,\n        header: weekdays[i],\n        ratioDailyTarget: today.dayOfWeek === i + 1 ? 0 : undefined\n      }\n    }\n  }\n  data = newData\n  if (spinner.parentElement) {\n    app.removeChild(spinner)\n  }\n  Unstable_gallery.prepareData(data)\n  Unstable_gallery.addEventListeners()\n  Unstable_gallery.scheduleRender()\n} catch (err) {\n  console.error(err)\n}\n\nfunction getDateName(dateStr) {\n  const date = Temporal.PlainDate.from(dateStr);\n  const dayName = weekdays[date.dayOfWeek /* range 1-7*/ - 1];\n\treturn dayName\n}\n"],"names":["Temporal","Unstable_gallery","spinner","document","createElement","src","classList","add","app","getElementById","appendChild","params","URLSearchParams","listType","response","fetch","toString","dayRecords","json","newData","today","Now","plainDateISO","i","length","d","dayOfWeek","PlainDate","from","date","ratioDailyTarget","net_words_change","targetWordsDaily","source","id","w","h","prompt","header","getDateName","dateStr","weekdays","undefined","data","parentElement","removeChild","prepareData","addEventListeners","scheduleRender","err","console","error"],"mappings":"AAEA,OAASA,YAAAA,CAAQ,KAAQ,mBAAmB,AAC5C,QAAOC,MAAsB,uBAAuB,CAEpD,IAAMC,EAAUC,SAASC,aAAa,CAAC,MACvCF,CAAAA,EAAQG,GAAG,CAAG,qBACdH,EAAQI,SAAS,CAACC,GAAG,CAAC,UACtB,IAAMC,EAAML,SAASM,cAAc,CAAC,QAEpCD,EAAIE,WAAW,CAACR,GAEhB,GAAI,CAMF,IAAK,IALCS,EAAS,IAAIC,gBAAgB,CAAEC,SAAAA,QAAS,GACxCC,EAAW,MAAMC,MAAM,AAAC,mBAAoC,OAAlBJ,EAAOK,QAAQ,KACzDC,EAAa,MAAMH,EAASI,IAAI,GAChCC,EAAU,CAAC,KAAK,KAAK,KAAK,KAAK,KAAM,KAAK,KAAK,CACjDC,EAAQpB,EAASqB,GAAG,CAACC,YAAY,CAAC,oBAC7BC,EAAI,EAAGA,EAAIN,EAAWO,MAAM,EAAID,EAAI,EAAGA,IAAK,CACnD,IAAME,EAAIR,CAAU,CAACM,EAAE,CACjB,AAAEG,EAAc1B,EAAS2B,SAAS,CAACC,IAAI,CAACH,EAAEI,IAAI,EAA5CH,UACFI,EAAmBL,EAAEM,gBAAgB,CAAGC,iBAAmB,GACjEb,CAAAA,CAAO,CAACO,EAAY,EAAE,CAAG,CACvBO,OAAQR,EACRS,GAAIT,EAAES,EAAE,CACRC,EAAG,IACHC,EAAG,IACHC,OAAQZ,EAAEM,gBAAgB,CAC1BO,OAAQC,AA6Bd,SAAqBC,CAAO,EAC1B,IAAMX,EAAO7B,EAAS2B,SAAS,CAACC,IAAI,CAACY,GAEtC,OADiBC,QAAQ,CAACZ,EAAKH,SAAS,CAAkB,EAAE,AAE7D,EAjC0BD,EAAEI,IAAI,EAC1BC,iBAAAA,CACF,CACF,CACA,IAAK,IAAIP,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAME,EAAIN,CAAO,CAACI,EAAE,AAChBE,AAAM,QAANA,GACFN,CAAAA,CAAO,CAACI,EAAE,CAAG,CACXU,OAAQ,KACRC,GAAIX,EACJY,EAAG,IACHC,EAAG,IACHC,OAAQ,EACRC,OAAQG,QAAQ,CAAClB,EAAE,CACnBO,iBAAkBV,EAAMM,SAAS,GAAKH,EAAI,EAAI,EAAImB,KAAAA,CACpD,CAAA,CAEJ,CACAC,KAAOxB,EACHjB,EAAQ0C,aAAa,EACvBpC,EAAIqC,WAAW,CAAC3C,GAElBD,EAAiB6C,WAAW,CAACH,MAC7B1C,EAAiB8C,iBAAiB,GAClC9C,EAAiB+C,cAAc,EACjC,CAAE,MAAOC,EAAK,CACZC,QAAQC,KAAK,CAACF,EAChB"}