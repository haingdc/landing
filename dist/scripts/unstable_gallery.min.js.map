{"version":3,"sources":["scripts/unstable_gallery.js"],"sourceRoot":"/public","sourcesContent":["/// <reference lib=\"dom\" />\nimport getColor from '../scripts/getColor.js'\n\n// === generic scheduler & its debugger\nlet scheduledRender = false\nfunction scheduleRender() {\n  if (scheduledRender) return;\n  scheduledRender = true\n  requestAnimationFrame(function renderAndMaybeScheduleAnotherRender(now) { // eye-grabbing name. No \"(anonymous)\" function in the debugger & profiler\n    scheduledRender = false\n    if (data.length === 0) {\n      scheduleRender()\n      return\n    }\n    if (render(now)) scheduleRender()\n  })\n}\n\n// === generic spring physics\n// 4ms/step for the spring animation's step. Typically 4 steps for 60fps (16.6ms/frame) and 2 for 120fps (8.3ms/frame). Frame time delta varies, so not always true\n// could use 8ms instead, but 120fps' 8.3ms/frame means the computation might not fit in the remaining 0.3ms, which means sometime the simulation step wouldn't even run once, giving the illusion of jank\nconst msPerAnimationStep = 4\nfunction spring(pos, v = 0, k = 290, b = 30) {\n  return {pos, dest: pos, v, k, b} // k = stiffness, b = damping. Try https://chenglou.me/react-motion/demos/demo5-spring-parameters-chooser/\n}\nfunction springStep(config) {\n  // https://blog.maximeheckel.com/posts/the-physics-behind-spring-animations/\n  // this seems inspired by https://github.com/chenglou/react-motion/blob/9e3ce95bacaa9a1b259f969870a21c727232cc68/src/stepper.js\n  const t = msPerAnimationStep / 1000 // convert to seconds for the physics equation\n  const {pos, dest, v, k, b} = config\n  // for animations, dest is actually spring at rest. Current position is the spring's stretched/compressed state\n  const Fspring = -k * (pos - dest) // Spring stiffness, in kg / s^2\n  const Fdamper = -b * v // Damping, in kg / s\n  const a = Fspring + Fdamper // a needs to be divided by mass, but we'll assume mass of 1. Adjust k and b to change spring curve instead\n  const newV = v + a * t\n  const newPos = pos + newV * t\n\n  config.pos = newPos; config.v = newV\n}\nfunction springGoToEnd(config) {\n  config.pos = config.dest\n  config.v = 0\n}\n\n// === generic helpers\nfunction clamp(min, v, max) {\n  return v > max ? max : v < min ? min : v\n}\n\n// === constant layout metrics. The rest is dynamic\nconst promptPaddingBottom = 8\nconst promptSizeY = 44 + promptPaddingBottom // 44 is a magic number. Doesn't show the 3rd line nor cuts the 2nd line on safari, mobile safari and chrome\nconst prompt1DSizeY = 64 + promptPaddingBottom // size in 1d mode\nconst boxesGapX = 24, boxesGapY = 24\nconst boxes1DGapX = 52, boxes1DGapY = 28\nconst windowPaddingTop = 40\nconst gapTopPeek = 40 // used when programmatically scrolling and wanting to show some gap at the top of a row\nconst hitArea1DSizeX = 100 // left and right click region in 1D mode\nconst chiThiMauSize = 100\n\nfunction colsBoxMaxSizeXF(containerSizeX) {\n  const boxMinSizeX = 220 // Make sure that on mobile, this min width is big enough not to show 2 images per row. Also, this won't be respected if view's tiny\n  const cols = clamp(1, Math.floor((containerSizeX - boxesGapX) / (boxMinSizeX + boxesGapX)), 7) // half of boxesGapX for container's left and right gap\n  const boxMaxSizeX = (containerSizeX - boxesGapX - cols * boxesGapX) / cols\n  return {cols, boxMaxSizeX}\n}\n\nconst isSafari = navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome') // Chrome also includes Safari in user-agent string\nif (isSafari) {\n  // alright *deep breath* Desktop Safari is fine, but iPad Safari behaves badly when items exceed the viewport in 1D mode (overflow hidden doesn't work!). This is prominent if you hold arrow right and check the GitHub logo move. It's especially pathological on Stage Manager and any other iPad Safari mode where the app window shrinks and bugs the browser more for whatever reason\n  // so we use contain: layout plus viewport width and height to force the clipping of items. Now every browser behaves well with these, BUT Chrome doesn't have rubberbanding of inner elements (only page-wide one). So YES I'm switching to scrolling page instead of document body for Chrome JUST FOR THE RUBBER BANDING on macOS.\n  // this is how much I care about edge scroll rubber banding. Thanks Bas Ording & old Apple. If browser specs folks were more visual & interactions-driven as opposed to being static document-driven then we wouldn't have a decade-long decline of visual & interaction design as a discipline.\n  // it's a good thing these hacks are easy to pull off under this architecture, and quite readable and even robust despite changing whole container logics\n  document.body.style.contain = 'layout'\n  document.body.style.width = '100vw'\n  document.body.style.height = '100vh'\n}\n\n// === state. Plus one in the URL's hash\nconst debug = false // toggle this for manually stepping through animation frames (press key A)\nlet debugTimestamp = 0\nlet animatedUntilTime = null\nlet reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)')\nlet anchor = 0 // keep a box stable during resize layout shifts\nlet windowSizeX = document.documentElement.clientWidth\nlet scrollY = isSafari ? document.body.scrollTop : window.scrollY\nlet pointer = {x: -Infinity, y: -Infinity} // btw, on page load, there's no way to render a first cursor state =(\nlet events = { keydown: null, click: null, mousemove: null }\n\nfunction prepareData() {\n  const windowSizeY = document.documentElement.clientHeight\n  const {cols, boxMaxSizeX} = colsBoxMaxSizeXF(windowSizeX)\n  const imgMaxSizeY = boxMaxSizeX + 100 // TODO: adjust this better\n  data = data.map((d, i) => {\n    const ar = d.w / d.h\n    const sizeX = Math.min(d.w, boxMaxSizeX, imgMaxSizeY * ar)\n    const sizeY = sizeX / ar + promptSizeY\n    // upon zooming into 1D mode (big image), swapping out an img src for a higher-res one would cause a flash of blank image in certain cases. Instead, we put the low-res image as a background-image on the container, then the high-res image as a real img on top. Hand-rolled double buffering...\n    let node = document.createElement('div')\n        node.className = 'box'\n        node.setAttribute('onclick', 'void(0)') // prevent default click behavior on the box, e.g. focus\n        // node.tabIndex = i + 1 // uncomment when dismiss focus isn't this ugly blue hue anymore\n        node.style.backgroundImage = `url(https://cdn.ngayhe.com/${d.id}_384_N.webp)` // 128 is the next smallest. Too small for retina screens\n    let img = document.createElement('img')\n        // img.decoding = 'async' // this sucks. It's slower _and_ still janks the UI. No point\n    let promptNode = document.createElement('figcaption')\n        promptNode.className = 'prompt'\n        promptNode.textContent = d.prompt\n    let chiThiMau = document.createElement('div')\n        chiThiMau.className = 'chỉ-thị-màu'\n    let header = document.createElement('div')\n        header.className = \"header\"\n        header.textContent = d.header\n    if (d.ratioDailyTarget === undefined) {\n      let chiThiMauImg = document.createElement('img')\n          chiThiMauImg.src = '/img/Snoopy-doghouse-1.png'\n      chiThiMau.append(chiThiMauImg)\n    }\n    node.append(img, promptNode, chiThiMau, header)\n    return {\n      id: d.id,\n      naturalSizeX: d.w,\n      ar, // aspect ratio\n      sizeX: spring(sizeX),\n      sizeY: spring(sizeY), // image + prompt\n      x: spring(Math.floor(i / cols) * -windowSizeX - windowSizeX), // unfold from lower left. More visible on long screens\n      y: spring(windowSizeY + Math.floor(i / cols) * imgMaxSizeY),\n      scale: spring(1),\n      fxFactor: spring(20), // for brightness and blur\n      node,\n      ratioDailyTarget: d.ratioDailyTarget\n    }\n  })\n}\nfunction springForEach(f) { // no spring ownership struggle between the spring library above vs consumer; un-inversion of control!\n  for (let d of data) {\n    f(d.sizeX); f(d.sizeY); f(d.x); f(d.y); f(d.scale); f(d.fxFactor) // no different than [a, b, c].forEach(f)\n  }\n}\n\n// === events\nfunction addEventListeners() {\n// pointermove doesn't work on android, pointerdown isn't fired on Safari on the first left click after dismissing context menus, mousedown doesn't trigger properly on mobile, pointerup isn't triggered when pointer panned (at least on iOS), don't forget contextmenu event. Tldr there's no pointer event that works cross-browser that can replace mouse & touch events.\nwindow.addEventListener('resize', () => scheduleRender())\nwindow.addEventListener('scroll', () => scheduleRender(), true) // capture is needed for iPad Safari...\nwindow.addEventListener('popstate', () => scheduleRender())\nwindow.addEventListener('keydown', (e) => {events.keydown = e; scheduleRender()})\nwindow.addEventListener('click', (e) => {events.click = e; scheduleRender()})\nwindow.addEventListener('mousemove', (e) => {events.mousemove = e; scheduleRender()})\n}\n\n// === static DOM initialization. Just 1 in this app. The more you have here the more your app looks like a PDF document. Minimize\nlet dummyPlaceholder = document.createElement('div')\ndummyPlaceholder.style.position = 'absolute'\ndummyPlaceholder.style.width = '1px' // make it tiny in case it affects compositing... sigh lamport.azurewebsites.net/pubs/future-of-computing.pdf\ndocument.body.append(dummyPlaceholder)\nif (debug) {\n  document.documentElement.style.background = 'repeating-linear-gradient(#e66465 0px, #9198e5 300px)'\n  document.documentElement.style.height = '100%'\n}\n\n// === hit testing logic. Boxes' hit area should be static and not follow their current animated state usually (but we can do either)\nfunction hitTest2DMode(data, pointerX, pointerY) {\n  for (let i = 0; i < data.length; i++) {\n    let {x, y, sizeX, sizeY} = data[i]\n    if (x.dest <= pointerX && pointerX < x.dest + sizeX.dest && y.dest <= pointerY && pointerY < y.dest + sizeY.dest) return i // pointer on this box\n  }\n  return null\n}\nfunction hitTest1DMode(data, focused, windowSizeX, pointerX) {\n  // allow spamming clicks without accidentally clicking on an empty region on left/right side or newly focused image during transition (and dismiss 1D mode)\n  return focused > 0 && 0 <= pointerX /* might be -Infinity */ && pointerX <= hitArea1DSizeX ? Math.max(0, focused - 1) // left\n    : focused < data.length - 1 && pointerX >= windowSizeX - hitArea1DSizeX ? Math.min(data.length - 1, focused + 1) // right\n    : null\n}\n\nfunction render(now) {\n  // === step 0: process events\n  // keydown\n  const inputCode = events.keydown == null ? null : events.keydown.code\n\n  // click\n  let clickedTarget = null\n  if (events.click != null) {\n    // needed to update coords even when we already track mousemove. E.g. in Chrome, right click context menu, move elsewhere, then click to dismiss. BAM, mousemove triggers with stale/wrong (??) coordinates... Click again without moving, and now you're clicking on the wrong thing\n    clickedTarget = events.click.target\n    pointer.x = events.click.clientX; pointer.y = events.click.clientY\n  }\n  // mousemove\n  if (events.mousemove != null) {\n    // we only use clientX/Y, not pageX/Y, because we want to ignore scrolling. See comment around isSafari above; we either scroll body or window depending on the browser, so pageX/Y might be meaningless (if Safari)\n    pointer.x = events.mousemove.clientX; pointer.y = events.mousemove.clientY\n    // btw, pointer can exceed document bounds, e.g. dragging reports back out-of-bound, legal negative values\n  }\n\n  if (debug) {\n    if (inputCode === 'KeyA') debugTimestamp += 1000 / 60\n    now = debugTimestamp\n  }\n\n  // === step 1: batched DOM reads (to avoid accidental DOM read & write interleaving)\n  const newWindowSizeX = document.documentElement.clientWidth // excludes scroll bar & invariant under safari pinch zoom\n  const windowSizeY = document.documentElement.clientHeight // same\n  // this way, when pinch zooming in, we don't occlude away rows outside of the view; if we did, when we zoom out again we wouldn't see those occluded rows until we release our fingers. During safari pinch, no event is triggered so we couldn't have updated the occlusion in real time\n  const animationDisabled = reducedMotion.matches\n  const currentScrollY = isSafari ? document.body.scrollTop : window.scrollY\n  const currentScrollX = isSafari ? document.body.scrollLeft : window.scrollX\n  const hashImgId = window.location.hash.slice(1)\n\n  let focused = null; for (let i = 0; i < data.length; i++) if (data[i].id === hashImgId) focused = i\n  // don't forget top & bottom safari UI chrome sizes when vertically occluding, since they're transluscent so we can't over-occlude by ignoring them\n  const pointerXLocal = pointer.x +/*toLocal*/currentScrollX, pointerYLocal = pointer.y +/*toLocal*/currentScrollY\n\n  // === step 2: handle inputs-related state change\n  // keys\n  let newFocused =\n    inputCode === 'Escape' ? null\n    : (inputCode === 'ArrowLeft' || inputCode === 'ArrowRight') && focused == null ? 0\n    : inputCode === 'ArrowLeft' ? Math.max(0, focused - 1)\n    : inputCode === 'ArrowRight' ? Math.min(data.length - 1, focused + 1)\n    : focused\n  // pointer\n  if (clickedTarget != null) { // clicked\n    if (clickedTarget.tagName === 'FIGCAPTION') { // select the whole prompt\n      let selection = window.getSelection()\n      let range = document.createRange()\n      range.selectNodeContents(clickedTarget)\n      selection.removeAllRanges()\n      selection.addRange(range)\n    } else if (focused == null) { // in 2D grid mode. Find the box the pointer's on\n      newFocused = hitTest2DMode(data, pointerXLocal, pointerYLocal) ?? newFocused\n      console.log('newFocused', newFocused)\n    } else { // 1D mode\n      newFocused = hitTest1DMode(data, focused, newWindowSizeX, pointerXLocal)\n    }\n  }\n\n  // === step 3: calculate new layout & cursor\n  const {cols, boxMaxSizeX} = colsBoxMaxSizeXF(newWindowSizeX)\n  let boxes2DSizeX = [], boxes2DSizeY = [], rowsTop = [windowPaddingTop] // length: number of rows + 1\n  { // first pass over data to set final 2D dimensions and row height (for vertical centering in 2D & total scrollbar height)\n    let rowMaxSizeY = 0\n    for (let i = 0; i < data.length; i++) {\n      let d = data[i]\n      const imgMaxSizeY =\n        d.ar === 1 ? boxMaxSizeX * 0.85 // square aspect ratio area too big. Shrink it\n        : d.ar < 1 ? boxMaxSizeX * 1.05 // vertical images look a bit small. Grow it\n        : boxMaxSizeX\n      const sizeX = Math.min(d.naturalSizeX, boxMaxSizeX, imgMaxSizeY * d.ar)\n      const sizeY = sizeX / d.ar + promptSizeY\n      boxes2DSizeX.push(sizeX)\n      boxes2DSizeY.push(sizeY)\n      rowMaxSizeY = Math.max(rowMaxSizeY, sizeY)\n      if (i % cols === cols - 1 || i === data.length - 1) { // last box of the row or last box ever\n        rowsTop.push(rowsTop.at(-1) + rowMaxSizeY + boxesGapY)\n        rowMaxSizeY = 0\n      }\n    }\n  }\n  let cursor\n  let newAnchor = anchor\n  let adjustedScrollTop = currentScrollY\n  const hoverMagnetFactor = 40\n  if (newFocused == null) { // 2D mode\n    if (focused != null) { // just dismissed 1D mode\n      const focusedTop = rowsTop[Math.floor(focused / cols)]\n      // if the dismissed box isn't fully shown, scroll to it (later after the render code block)\n      if (focusedTop <= currentScrollY || focusedTop + boxes2DSizeY[focused] >= currentScrollY + windowSizeY) {\n        adjustedScrollTop = focusedTop - boxesGapY - gapTopPeek // Peek a little higher to show the previous row\n      }\n    }\n\n    for (let i = 0; i < data.length; i++) { // calculate boxes positions\n      let d = data[i]\n      const sizeX = boxes2DSizeX[i], sizeY = boxes2DSizeY[i]\n      const currentRow = Math.floor(i / cols)\n      const rowMaxSizeY = rowsTop[currentRow + 1] - boxesGapY - rowsTop[currentRow] // this is restoring the rowMaxSizeY info above, kinda weird\n      d.sizeX.dest = sizeX\n      d.sizeY.dest = sizeY\n      d.x.dest = boxesGapX + (boxMaxSizeX + boxesGapX) * (i % cols) + (boxMaxSizeX - sizeX) / 2 // center horizontally\n      d.y.dest = rowsTop[currentRow] + (rowMaxSizeY - sizeY) / 2\n      d.scale.dest = 1\n      d.fxFactor.dest = 1\n    }\n\n    const hit = hitTest2DMode(data, pointerXLocal, pointerYLocal)\n    if (hit == null) cursor = 'auto'\n    else { // hovering over a box. Adjust position\n      cursor = 'zoom-in'\n      let {x, y, sizeX, sizeY, scale} = data[hit]\n      x.dest += (pointerXLocal - (x.dest + sizeX.dest / 2)) / hoverMagnetFactor\n      y.dest += (pointerYLocal - (y.dest + sizeY.dest / 2)) / hoverMagnetFactor\n      scale.dest = 1.02\n    }\n    // if layout shifted, keep the boxes near the same place to prevent annoying layout jumps while viewing\n    const anchorY = data[anchor].y.dest - gapTopPeek\n    if (newWindowSizeX !== windowSizeX) adjustedScrollTop = Math.max(0, anchorY) // resized; maintain position!\n    if (adjustedScrollTop !== scrollY && Math.abs(anchorY -/*toLocal*/adjustedScrollTop) > windowSizeY / 10) { // find new anchor if the current one moved too much\n      for (newAnchor = 0; newAnchor < data.length; newAnchor += cols) { // new anchor is picked from leftmost column. Btw old anchor might not be from leftmost col due to resize layout shifts\n        let d = data[newAnchor]\n        // find 1st box whose bottom exceeds 20% of window height\n        if (d.y.dest + d.sizeY.dest -/*toLocal*/adjustedScrollTop > windowSizeY / 5) break\n      }\n    }\n  } else { // 1D mode\n    const img1DSizeY = windowSizeY - windowPaddingTop - prompt1DSizeY - boxes1DGapY\n    const box1DMaxSizeX = newWindowSizeX - boxes1DGapX * 2 - hitArea1DSizeX * 2\n\n    let currentLeft = hitArea1DSizeX + boxes1DGapX // start from the right edge of the left box and...\n    for (let i = newFocused - 1; i >= 0; i--) { // ...iterate til we get the left edge of the very first box\n      let d = data[i]\n      const imgSizeX = Math.min(d.naturalSizeX, box1DMaxSizeX, img1DSizeY * d.ar) * 0.7\n      currentLeft -= imgSizeX + boxes1DGapX\n    }\n\n    const edgeRubberBandVelocityX = // feedback when you hit first/last image and keep pressing left/right key\n      inputCode === 'ArrowLeft' && focused === 0 ? 2 * 1000 // 2 pixels per second\n      : inputCode === 'ArrowRight' && focused === data.length - 1 ? -2 * 1000\n      : 0\n    for (let i = 0; i < data.length; i++) { // calculate boxes positions\n      let d = data[i]\n      const imgSizeX = Math.min(d.naturalSizeX, box1DMaxSizeX, img1DSizeY * d.ar) * (i === newFocused ? 1 : 0.7)\n      const boxSizeY = imgSizeX / d.ar + prompt1DSizeY\n      d.sizeX.dest = imgSizeX\n      d.sizeY.dest = boxSizeY\n      d.y.dest = Math.max(windowPaddingTop, (windowSizeY - boxSizeY) / 2) +/*toLocal*/adjustedScrollTop\n      d.x.dest = i === newFocused ? (newWindowSizeX - imgSizeX) / 2 : currentLeft\n      d.x.v += edgeRubberBandVelocityX / (i === newFocused ? 1 : 4)\n      d.scale.dest = 1\n      d.fxFactor.dest = i === newFocused ? 1 : 0.2 // center image has no brightness & blur effect\n\n      currentLeft = i === newFocused ? newWindowSizeX - hitArea1DSizeX : currentLeft + imgSizeX + boxes1DGapX\n    }\n\n    const hit = hitTest1DMode(data, newFocused, newWindowSizeX, pointerXLocal)\n    if (hit == null) cursor = 'zoom-out'\n    else { // hovering on left or right image\n      cursor = 'zoom-in'\n      let {x, y, sizeX, sizeY, scale, fxFactor} = data[hit]\n      x.dest += (pointerXLocal - (x.dest + sizeX.dest / 2)) / hoverMagnetFactor\n      y.dest += (pointerYLocal - (y.dest + sizeY.dest / 2)) / hoverMagnetFactor\n      scale.dest = 1.02\n      fxFactor.dest = 0.5\n    }\n  }\n  // ensure that no matter how the scrolling is abruptly adjusted, the boxes on the screen don't suddenly jump too. When going 1D->2D mode where the dismissed image might be far from the initial one, or when resizing causes layout shifts, the boxes now stay unaffected!\n  for (let {y} of data) y.pos += adjustedScrollTop - currentScrollY\n\n  // === step 4: run animation\n  let newAnimatedUntilTime = animatedUntilTime ?? now\n  const steps = Math.floor((now - newAnimatedUntilTime) / msPerAnimationStep) // run x spring steps. Decouple physics simulation from framerate!\n  newAnimatedUntilTime += steps * msPerAnimationStep\n  let stillAnimating = false\n  if (animationDisabled) springForEach(springGoToEnd)\n  else {\n    springForEach(s => {\n      for (let i = 0; i < steps; i++) springStep(s)\n      if (Math.abs(s.v) < 0.01 && Math.abs(s.dest - s.pos) < 0.01) springGoToEnd(s) // close enough, done\n      else stillAnimating = true\n    })\n  }\n\n  // === step 5: render. Batch DOM writes\n  const browserUIMaxSizeTop = 100, browserUIMaxSizeBottom = 150 // browsers UI like Safari are transluscent. Random conservative numbers\n  for (let i = 0; i < data.length; i++) {\n    let d = data[i]\n    let {node} = d, img = node.children[0], prompt = node.children[1], chiThiMau = node.children[2]\n    if ( // occlusion culling, aka only draw what's visible on screen (aka \"virtualization\")\n      d.y.pos -/*toGlobal*/adjustedScrollTop <= windowSizeY + browserUIMaxSizeBottom &&\n      d.y.pos + d.sizeY.pos -/*toGlobal*/adjustedScrollTop >= -browserUIMaxSizeTop &&\n      d.x.pos <= newWindowSizeX &&\n      d.x.pos + d.sizeX.pos >= 0\n    ) { // disregard shadow & scaling for now; browserUIMaxSizeBottom and browserUIMaxSizeTop are safe bigger values anyway\n      node.style.width = `${d.sizeX.pos}px`\n      node.style.height = `${d.sizeY.pos}px`\n      node.style.transform = `translate3d(${d.x.pos}px,${d.y.pos}px,0) scale(${d.scale.pos})` // safari now anti-aliases for hover, but then zoom in janks on big displays...\n      // we can't afford fxFactor & blur for all pics; too expensive for Safari & Chrome. E.g. when zomming out of a photo, keep scrolling; Chrome stops render on Studio Display\n      node.style.filter = newFocused != null && i === newFocused - 1 || i === newFocused || i === newFocused + 1\n        ? `brightness(${d.fxFactor.pos * 100}%) blur(${Math.max(0, 6 - d.fxFactor.pos * 6)}px)` // blur these 3 only\n        : `brightness(${d.fxFactor.pos * 100}%)` // blur of unrelated pics is too fast during transition from/to 1D mode to be seen anyway\n      if (debug) node.style.outline = i === newAnchor ? '2px solid rgba(255, 255, 0, 0.8)' : 'none'\n      prompt.style.top = `${d.sizeX.pos / d.ar}px` // right below img's sizeY\n\n      if (i === newFocused) {\n        node.style.zIndex = data.length + 999 // guaranteed above everything\n        prompt.style.overflowY = 'auto'\n        prompt.style.height = `${prompt1DSizeY - promptPaddingBottom}px`\n        prompt.style.lineClamp = prompt.style.webkitLineClamp = 999\n        img.style.display = 'block'\n        let src = `https://cdn.midjourney.com/${d.id}.webp`\n        // if (!stillAnimating && img.src !== src) img.src = src // load the full res image\n        chiThiMau.style.width = chiThiMau.style.height = `${chiThiMauSize}px`\n        chiThiMau.style.left = `${(d.sizeX.pos - chiThiMauSize) / 2}px`\n        let { light, saturation, hue } = getColor(d.ratioDailyTarget);\n        chiThiMau.style.background = `hsl(${hue}deg ${saturation}% ${light}%)`;\n      } else {\n        node.style.zIndex = i + 1 // simple proper z-index management\n        prompt.style.overflowY = 'hidden'\n        prompt.style.height = `${promptSizeY - promptPaddingBottom}px`\n        prompt.style.lineClamp = prompt.style.webkitLineClamp = 2\n        img.style.display = 'none' // hide full res image for perf (yes it makes a difference, even on M1, with Studio Display)\n        chiThiMau.style.width = chiThiMau.style.height = `${chiThiMauSize}px`\n        chiThiMau.style.left = `${(d.sizeX.pos - chiThiMauSize) / 2}px`\n        chiThiMau.style.top = `${(d.sizeY.pos - chiThiMauSize) / 2}px`\n        let { light, saturation, hue } = getColor(d.ratioDailyTarget);\n        chiThiMau.style.background = `hsl(${hue}deg ${saturation}% ${light}%)`;\n      }\n      if (node.parentNode == null) document.body.appendChild(node) // if previously absent, add\n    } else if (node.parentNode != null) document.body.removeChild(node) // if previously present, remove\n  }\n\n  document.body.style.cursor = cursor\n  document.body.style.overflowY = newFocused == null ? 'auto' : 'hidden'\n  dummyPlaceholder.style.height = `${rowsTop.at(-1)}px` // Chrome has race conditon if scrollTo is called before setting a longer dummy height\n\n  // === step 6: update state & prepare for next frame\n  // if (adjustedScrollTop !== currentScrollTop) window.scrollTo({top: adjustedScrollTop}) // will trigger scrolling, thus next frame's render\n  if (adjustedScrollTop !== currentScrollY) {\n    // see comment about isSafari above\n    (isSafari ? document.body : window).scrollTo({top: adjustedScrollTop}) // will trigger scrolling, thus next frame's render\n  }\n  if (newFocused !== focused) {\n    window.history.pushState(null, '', `${window.location.pathname}${window.location.search}${newFocused == null ? '' : '#' + data[newFocused].id}`)\n  }\n  events.keydown = events.click = events.mousemove = null\n  animatedUntilTime = stillAnimating ? newAnimatedUntilTime : null\n  anchor = newAnchor\n  windowSizeX = newWindowSizeX\n  scrollY = adjustedScrollTop\n\n  return stillAnimating\n}\n\n// scheduleRender()\n\nexport default {\n  scheduleRender,\n  addEventListeners,\n  prepareData,\n}"],"names":["getColor","scheduledRender","scheduleRender","requestAnimationFrame","now","data","length","render","inputCode","events","keydown","code","clickedTarget","click","target","pointer","x","clientX","y","clientY","mousemove","newWindowSizeX","document","documentElement","clientWidth","windowSizeY","clientHeight","animationDisabled","reducedMotion","matches","currentScrollY","isSafari","body","scrollTop","window","scrollY","currentScrollX","scrollLeft","scrollX","hashImgId","location","hash","slice","focused","i","id","pointerXLocal","pointerYLocal","newFocused","Math","max","min","tagName","hitTest2DMode","selection","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","console","log","hitTest1DMode","colsBoxMaxSizeXF","cols","boxMaxSizeX","boxes2DSizeX","boxes2DSizeY","rowsTop","rowMaxSizeY","d","imgMaxSizeY","ar","sizeX","naturalSizeX","sizeY","promptSizeY","push","at","newAnchor","anchor","adjustedScrollTop","focusedTop","floor","currentRow","dest","boxesGapX","scale","fxFactor","hit","cursor","anchorY","windowSizeX","abs","img1DSizeY","prompt1DSizeY","box1DMaxSizeX","boxes1DGapX","hitArea1DSizeX","currentLeft","imgSizeX","edgeRubberBandVelocityX","boxSizeY","v","pos","newAnimatedUntilTime","animatedUntilTime","steps","stillAnimating","springForEach","springGoToEnd","s","springStep","config","newV","a","Fspring","k","b","msPerAnimationStep","node","img","children","prompt","chiThiMau","style","width","height","transform","filter","top","zIndex","overflowY","lineClamp","webkitLineClamp","display","left","ratioDailyTarget","light","saturation","hue","background","parentNode","appendChild","removeChild","dummyPlaceholder","scrollTo","history","pushState","pathname","search","spring","containerSizeX","boxMinSizeX","navigator","userAgent","includes","contain","matchMedia","Infinity","f","createElement","pointerX","pointerY","position","append","addEventListeners","addEventListener","e","prepareData","map","w","h","className","setAttribute","backgroundImage","promptNode","textContent","header","undefined","chiThiMauImg","src"],"mappings":"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"}