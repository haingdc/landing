{"version":3,"sources":["scripts/unstable_spinDelay.js"],"sourceRoot":"/public","sourcesContent":["\n/**\n * Delays showing a spinner until a promise has been pending for a certain time.\n * If the promise resolves/rejects before that time, no spinner is shown.\n * If the promise resolves/rejects after that time, the spinner is shown for\n * at least a minimum duration.\n * @param {Promise} promise The promise to monitor\n * @param {Object} options Configuration options\n * @param {number} options.delay Time in ms to wait before showing the spin\n * @param {number} options._minDuration Minimum time in ms the spin should be visible\n */\nexport async function unstable_delaySpin(promise, { delay, _minDuration} = { delay: 3000, _minDuration: 1000}) {\n  let result = {\n    state: 'pending',\n  }\n  let startTime = performance.now(),\n      endTime = undefined\n  promise.then(res => {\n    result.state = 'fulfilled'\n  }).catch(err => {\n    result.state = 'rejected'\n  }).finally(() => {\n    endTime = performance.now()\n    console.log('elapsed', `${endTime - startTime}ms`)\n  })\n  let p2 = new Promise((res, rej) => {\n    setTimeout(() => {\n      if (result.state === 'pending') { // task is slow, let's show a spin\n        res('show_the_spin')\n      } else { // task is fast enough, we don't need a spin\n        res('idle')\n      }\n    }, delay)\n  })\n  let state = await p2\n  return state\n}\n\n// TODO: we need to write a test for this instead of just running it manually\n\n// uncomment to give it a try\n// var unpredictableMs = 3001\n// var p1 = new Promise((res, rej) => {\n//   setTimeout(() => {\n//     res('4')\n//   }, unpredictableMs)\n// })\n// await delaySpin(p1)"],"names":["unstable_delaySpin","promise","delay","result","startTime","endTime","_minDuration","state","performance","now","undefined","then","res","catch","err","finally","console","log","Promise","rej","setTimeout"],"mappings":"oHAWA,OAAO,SAAeA,8CAAmBC,CAAO,MAAE,EAAEC,EAC9CC,EAGAC,EACAC,6qCAkBQ,OAvBsCH,EAAF,CAAA,EAAA,+BAAyB,CAAEA,MAAO,IAAMI,aAAc,GAAI,CAAA,EAAxDJ,MAAF,EAASI,aACrDH,EAAS,CACXI,MAAO,SACT,EACIH,EAAYI,YAAYC,GAAG,GAC3BJ,EAAUK,KAAAA,EACdT,EAAQU,IAAI,CAACC,SAAAA,GACXT,EAAOI,KAAK,CAAG,WACjB,GAAGM,KAAK,CAACC,SAAAA,GACPX,EAAOI,KAAK,CAAG,UACjB,GAAGQ,OAAO,CAAC,WACTV,EAAUG,YAAYC,GAAG,GACzBO,QAAQC,GAAG,CAAC,UAAW,AAAC,GAAsB,OAApBZ,EAAUD,EAAU,MAChD,MACS,IAAIc,QAAQ,SAACN,EAAKO,GACzBC,WAAW,WACLjB,AAAiB,YAAjBA,EAAOI,KAAK,CACdK,EAAI,iBAEJA,EAAI,OAER,EAAGV,EACL,WAEA,SADY,YAEd"}